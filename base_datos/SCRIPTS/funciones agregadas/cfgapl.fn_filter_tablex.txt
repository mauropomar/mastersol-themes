CREATE OR REPLACE FUNCTION cfgapl.fn_filter_tablex
(
  IN  id_section  uuid    = NULL::uuid,
  IN  id_rol      uuid    = NULL::uuid,
  IN  id_user     uuid    = NULL::uuid,
  IN  "start"     integer = 0,
  IN  "limit"     integer = 20
)
RETURNS jsonb AS
$$
declare
res_data jsonb = null;
name_table varchar = $1;
begin
	SELECT tb.n_schema||'.'||tb.n_table into name_table from cfgapl.sections s JOIN cfgapl.tables tb on tb.id = s.id_tables where s.id = $1;

    EXECUTE 'SELECT jsonb_agg(rowset.*) FROM(SELECT dat.* FROM '|| name_table ||' dat WHERE dat.nombre ilike ''%tarea%'' OFFSET '|| $4 ||' LIMIT '|| $5 ||' )rowset ' INTO res_data;
    return res_data; 
end
$$
LANGUAGE 'plpgsql';

ALTER FUNCTION cfgapl.fn_filter_tablex(varchar, uuid, uuid, integer, integer)
  OWNER TO postgres;